<div class="property-details-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <i class="bi bi-hourglass-split"></i>
    <h3>Loading property details...</h3>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <i class="bi bi-exclamation-triangle"></i>
    <h3>{{ error }}</h3>
    <button class="btn btn-primary" (click)="goBack()">
      <i class="bi bi-arrow-left"></i> Back to Search
    </button>
  </div>

  <!-- Property Details -->
  <div *ngIf="!loading && !error && property" class="property-content">
    <!-- Header with Back Button -->
    <div class="property-header">
      <button class="back-btn" (click)="goBack()">
        <i class="bi bi-arrow-left"></i> Back to Search
      </button>
      <h1>{{ property.propertyTitle }}</h1>
      <div class="property-location">
        <i class="bi bi-geo-alt"></i>
        {{ property.city }}, {{ property.province }}, {{ property.country }}
      </div>
    </div>

    <div class="property-main">
      <!-- Image Gallery -->
      <div class="image-gallery" *ngIf="images.length > 0">
        <div class="main-image">
          <img
            [src]="images[currentImageIndex]"
            [alt]="property.propertyTitle || 'Property Image'"
            (error)="onImageError($event)"
          />
          <button
            class="image-nav-btn prev-btn"
            (click)="prevImage()"
            *ngIf="images.length > 1"
          >
            <i class="bi bi-chevron-left"></i>
          </button>
          <button
            class="image-nav-btn next-btn"
            (click)="nextImage()"
            *ngIf="images.length > 1"
          >
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
        <div class="image-thumbnails" *ngIf="images.length > 1">
          <img
            *ngFor="let image of images; let i = index"
            [src]="image"
            [class.active]="i === currentImageIndex"
            (click)="goToImage(i)"
            (error)="onImageError($event)"
            [alt]="'Property image ' + (i + 1)"
          />
        </div>
      </div>

      <div class="content-layout">
        <!-- Property Information -->
        <div class="property-info">
          <div class="host-info">
            <h3>Hosted by {{ property.firstName }} {{ property.lastName }}</h3>
            <p>
              {{ property.propertyType }} • {{ property.guests }} guests •
              {{ property.pets }} pets allowed
            </p>
          </div>

          <!-- <div class="property-description">
            <h4>About this place</h4>
            <p>
              {{ property.propertyDescription || "No description available" }}
            </p>
          </div> -->

          <div class="property-features">
            <div class="feature-section">
              <h4><i class="bi bi-house"></i> Property Details</h4>
              <div class="feature-grid">
                <div class="feature-item">
                  <i class="bi bi-people"></i>
                  <span>{{ property.guests }} guests maximum</span>
                </div>
                <div class="feature-item">
                  <i class="bi bi-door-open"></i>
                  <span>{{ property.bedrooms }} bedroom(s)</span>
                </div>
                <!-- <div class="feature-item">
                  <i class="bi bi-bed"></i>
                  <span>{{ property.beds }} bed(s)</span>
                </div> -->
                <div class="feature-item">
                  <i class="bi bi-droplet"></i>
                  <span>{{ property.bathrooms }} bathroom(s)</span>
                </div>
                <!-- <div class="feature-item">
                  <i class="bi bi-house"></i>
                  <span>{{ property.propertyType }}</span>
                </div> -->
              </div>
            </div>

            <div class="feature-section" *ngIf="property.ammenities">
              <h4><i class="bi bi-star"></i> Amenities</h4>
              <p>{{ property.ammenities }}</p>
            </div>

            <div class="feature-section" *ngIf="property.ammenitiesPets">
              <h4><i class="bi bi-heart"></i> Pet Amenities</h4>
              <p>{{ property.ammenitiesPets }}</p>
            </div>

            <div class="feature-section" *ngIf="property.allowedPetsType">
              <h4><i class="bi bi-check-circle"></i> Pets Allowed</h4>
              <p>
                {{ property.allowedPetsType }} (Maximum: {{ property.pets }})
              </p>
            </div>

            <div class="feature-section" *ngIf="property.petSizeRestrictions">
              <h4><i class="bi bi-info-circle"></i> Pet Size Restrictions</h4>
              <p>{{ property.petSizeRestrictions }}</p>
            </div>

            <div class="feature-section" *ngIf="property.houseRules">
              <h4><i class="bi bi-house-door"></i> House Rules</h4>
              <p>{{ property.houseRules }}</p>
            </div>

            <div class="feature-section" *ngIf="property.requiredVaccinations">
              <h4><i class="bi bi-shield-check"></i> Required Vaccinations</h4>
              <p>{{ property.requiredVaccinations }}</p>
            </div>
          </div>
        </div>

        <!-- Booking Card -->
        <div class="booking-card">
          <div class="price-section">
            <span class="price">${{ property.totalGuestPrice }}</span>
            <span class="period">per night</span>
          </div>

          <div class="booking-form">
            <h4>Select your dates</h4>

            <div class="date-selection-container">
              <!-- Date Display and Calendar Toggle -->
              <div class="selected-dates-display">
                <div class="selected-date">
                  <label>Check-in</label>
                  <div class="date-value" (click)="toggleCalendar()">
                    {{ bookingParams.checkIn || "Select date" }}
                    <i class="bi bi-calendar3"></i>
                  </div>
                </div>
                <div class="selected-date">
                  <label>Check-out</label>
                  <div class="date-value" (click)="toggleCalendar()">
                    {{ bookingParams.checkOut || "Select date" }}
                    <i class="bi bi-calendar3"></i>
                  </div>
                </div>
              </div>

              <!-- Visual Calendar -->
              <div class="calendar-container" *ngIf="showCalendar">
                <div class="calendar-header">
                  <button class="calendar-nav-btn" (click)="prevMonth()">
                    <i class="bi bi-chevron-left"></i>
                  </button>
                  <h4>{{ getMonthYear() }}</h4>
                  <button class="calendar-nav-btn" (click)="nextMonth()">
                    <i class="bi bi-chevron-right"></i>
                  </button>
                </div>

                <div class="calendar-weekdays">
                  <div class="weekday">Sun</div>
                  <div class="weekday">Mon</div>
                  <div class="weekday">Tue</div>
                  <div class="weekday">Wed</div>
                  <div class="weekday">Thu</div>
                  <div class="weekday">Fri</div>
                  <div class="weekday">Sat</div>
                </div>

                <div class="calendar-grid">
                  <div
                    *ngFor="let dateObj of calendarDates"
                    class="calendar-date"
                    [class.other-month]="!dateObj.isCurrentMonth"
                    [class.blocked]="dateObj.isBlocked"
                    [class.past]="dateObj.isPast"
                    [class.today]="dateObj.isToday"
                    [class.selected]="dateObj.isSelected"
                    [class.available]="
                      dateObj.isCurrentMonth &&
                      !dateObj.isPast &&
                      !dateObj.isBlocked
                    "
                    (click)="selectDate(dateObj)"
                  >
                    <span [class.strikethrough]="dateObj.isBlocked">{{
                      dateObj.day
                    }}</span>
                  </div>
                </div>

                <div class="calendar-legend">
                  <div class="legend-item">
                    <div class="legend-color available"></div>
                    <span>Available</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color blocked"></div>
                    <span>Booked</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color selected"></div>
                    <span>Selected</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Availability Info -->
            <div
              class="availability-info"
              *ngIf="loadingDates || blockedDates.length > 0"
            >
              <div *ngIf="loadingDates" class="loading-dates">
                <i class="bi bi-hourglass-split"></i>
                Loading availability...
              </div>
              <div
                *ngIf="!loadingDates && blockedDates.length > 0"
                class="blocked-dates-info"
              >
                <i class="bi bi-info-circle text-warning"></i>
                Some dates may not be available. You'll be notified if your
                selected dates conflict with existing bookings.
              </div>
            </div>

            <div class="guest-selection">
              <h5>Guests</h5>
              <div class="guest-controls">
                <div class="guest-row">
                  <span>Adults</span>
                  <select
                    [(ngModel)]="bookingParams.adults"
                    (change)="calculateStayDetails()"
                  >
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                  </select>
                </div>
                <div class="guest-row">
                  <span>Children</span>
                  <select
                    [(ngModel)]="bookingParams.children"
                    (change)="calculateStayDetails()"
                  >
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                </div>
                <div class="guest-row">
                  <span>Pets</span>
                  <select
                    [(ngModel)]="bookingParams.pets"
                    (change)="calculateStayDetails()"
                  >
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="booking-summary" *ngIf="bookingParams.totalNights > 0">
              <div class="summary-row">
                <span
                  >${{ property.totalGuestPrice }} x
                  {{ bookingParams.totalNights }} nights</span
                >
                <span>${{ bookingParams.totalPrice }}</span>
              </div>
              <div class="summary-total">
                <span>Total</span>
                <span>${{ bookingParams.totalPrice }}</span>
              </div>
            </div>

            <button
              class="book-btn"
              (click)="bookNow()"
              [disabled]="!bookingParams.checkIn || !bookingParams.checkOut"
            >
              <i class="bi bi-calendar-check"></i>
              Book Now
            </button>

            <button class="contact-btn" (click)="contactHost()">
              <i class="bi bi-chat"></i>
              Contact Host
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
